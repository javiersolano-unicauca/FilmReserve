--DDL

CREATE DATABASE filmreserve;

CREATE TABLE user (
	identification BIGINT NOT NULL,
	first_name VARCHAR(50) NOT NULL,
	second_name VARCHAR(50) NULL,
	first_surname VARCHAR(50) NOT NULL,
	second_surname VARCHAR(50) NULL,
	password VARCHAR(255) NOT NULL,
	administrator BOOLEAN NOT NULL DEFAULT false,
	CONSTRAINT pk_identification PRIMARY KEY(identification)

)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE customer (
	identification BIGINT NOT NULL,
	day INT(2) NOT NULL,
	month INT(2) NOT NULL,
	year INT(4) NOT NULL,
	phone BIGINT(10) NOT NULL,
	CONSTRAINT pk_identification PRIMARY KEY(identification),
	CONSTRAINT fk_user FOREIGN KEY(identification) REFERENCES user(identification) ON DELETE CASCADE,
	CONSTRAINT ck_day CHECK(day >= 1 AND day <= 31),
	CONSTRAINT ck_month CHECK(month >= 1 AND month <= 12),
	CONSTRAINT ck_year CHECK(year >= 1924),
	CONSTRAINT ck_phone CHECK(phone > 0)

)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE ticket_seller (
	identification BIGINT NOT NULL,
	turn VARCHAR(5) NOT NULL,
	CONSTRAINT pk_identification PRIMARY KEY(identification),
	CONSTRAINT fk_user1 FOREIGN KEY(identification) REFERENCES user(identification) ON DELETE CASCADE,
	CONSTRAINT ck_turn CHECK(turn in ('TARDE', 'NOCHE'))

)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE movie (
	id_movie BIGINT NOT NULL,
	name VARCHAR(50) NOT NULL,
	sypnosis VARCHAR(300) NOT NULL,
	poster_image VARCHAR(100) NOT NULL,
	CONSTRAINT pk_id_movie PRIMARY KEY(id_movie)

)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE gender(
	id_movie BIGINT NOT NULL,
	name VARCHAR(20) NOT NULL,
	CONSTRAINT pk_gender PRIMARY KEY(id_movie, name),
	CONSTRAINT fk_movie FOREIGN KEY(id_movie) REFERENCES movie(id_movie) ON DELETE CASCADE

)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE cinema_room(
	id_cinema_room BIGINT NOT NULL,
	CONSTRAINT pk_gender PRIMARY KEY(id_cinema_room)
	
)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE cin_presents_mov(
	id_movie BIGINT NOT NULL,
	id_cinema_room BIGINT NOT NULL,
	start_date DATE NOT NULL,
	end_date DATE NOT NULL,
	start_time TIME NOT NULL,
	end_time TIME NOT NULL,
	active BOOLEAN NOT NULL DEFAULT true,
	CONSTRAINT pk_cin_presents_mov PRIMARY KEY(id_movie, id_cinema_room, start_date),
	CONSTRAINT fk_movie1 FOREIGN KEY(id_movie) REFERENCES movie(id_movie) ON DELETE CASCADE,
	CONSTRAINT fk_cinema_room FOREIGN KEY(id_cinema_room) REFERENCES cinema_room(id_cinema_room) ON DELETE CASCADE

)ENGINE=InnoDB DEFAULT CHARSET=latin1;
	
 
